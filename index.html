<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JOSHCAB Training Institute - Digital Skills Courses</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <!-- Auth Manager -->
    <script src="auth-manager.js"></script>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a2b4a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="JOSHCAB INSTITUTE">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --navy: #1a2b4a;
            --dark-green: #1e5631;
            --gold: #d4af37;
            --light-gold: #f4e4a6;
            --light: #f8f9fa;
            --dark: #1a2b4a;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Install Prompt Styles */
        #installPromo {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            border-left: 4px solid var(--gold);
            max-width: 300px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            animation: slideInUp 0.3s ease;
        }
        
        @keyframes slideInUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        #installPromo p {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
            line-height: 1.4;
        }
        
        #installPromo button {
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            margin-right: 10px;
            transition: var(--transition);
        }
        
        #installPromo .install-btn {
            background: var(--dark-green);
            color: white;
        }
        
        #installPromo .install-btn:hover {
            background: #164322;
        }
        
        #installPromo .cancel-btn {
            background: transparent;
            color: #666;
        }
        
        #installPromo .cancel-btn:hover {
            color: #333;
        }
        
        /* Auth Modal Styles */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .auth-modal.active {
            display: flex;
        }
        
        .auth-container {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 450px;
            padding: 30px;
            box-shadow: var(--shadow);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            font-weight: 500;
            color: #777;
        }
        
        .auth-tab.active {
            color: var(--dark-green);
            border-bottom: 2px solid var(--dark-green);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .auth-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--dark-green);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 10px;
            transition: var(--transition);
        }
        
        .auth-btn:hover {
            background-color: #164322;
        }
        
        .auth-error {
            color: var(--danger);
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        
        .auth-success {
            color: var(--success);
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        
        .whatsapp-enroll {
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .whatsapp-enroll p {
            margin-bottom: 10px;
            color: #666;
        }
        
        .whatsapp-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background-color: #25D366;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .whatsapp-btn:hover {
            background-color: #128C7E;
            transform: translateY(-2px);
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--navy), var(--dark-green));
            color: white;
            padding: 15px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 24px;
            color: var(--gold);
        }
        
        .logo h1 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--navy);
        }
        
        .user-role-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .user-role-badge.admin {
            background-color: var(--danger);
            color: white;
        }
        
        .user-role-badge.student {
            background-color: var(--success);
            color: white;
        }
        
        .user-role-badge.kid {
            background-color: var(--warning);
            color: white;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        
        .auth-button {
            padding: 8px 15px;
            border: 1px solid white;
            border-radius: 20px;
            background: transparent;
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .auth-button:hover {
            background-color: var(--gold);
            color: var(--navy);
            border-color: var(--gold);
        }
        
        .contact-info {
            font-size: 14px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        /* Admin Panel Styles */
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1100;
            justify-content: center;
            align-items: center;
        }
        
        .admin-panel.active {
            display: flex;
        }
        
        .admin-container {
            background-color: white;
            border-radius: 10px;
            width: 95%;
            max-width: 1000px;
            height: 90vh;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .admin-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .admin-tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            color: #777;
        }
        
        .admin-tab.active {
            color: var(--dark-green);
            border-bottom: 2px solid var(--dark-green);
        }
        
        .admin-content {
            flex: 1;
            overflow-y: auto;
        }
        
        .admin-section {
            display: none;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .admin-table th, .admin-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .admin-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .admin-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .role-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .role-badge.admin {
            background-color: var(--danger);
            color: white;
        }
        
        .role-badge.student {
            background-color: var(--success);
            color: white;
        }
        
        .role-badge.kid {
            background-color: var(--warning);
            color: white;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .edit-btn {
            background-color: var(--warning);
            color: white;
        }
        
        .delete-btn {
            background-color: var(--danger);
            color: white;
        }
        
        .add-user-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(26, 43, 74, 0.85), rgba(30, 86, 49, 0.85)), url('https://images.unsplash.com/photo-1522202176988-66273c2fd55f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 80px 0;
            text-align: center;
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        
        .cta-button {
            display: inline-block;
            padding: 12px 30px;
            background-color: var(--gold);
            color: var(--navy);
            text-decoration: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: var(--transition);
        }
        
        .cta-button:hover {
            background-color: #e6c260;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .admin-button {
            display: inline-block;
            padding: 12px 30px;
            background-color: var(--danger);
            color: white;
            text-decoration: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: var(--transition);
            margin-left: 10px;
        }
        
        .admin-button:hover {
            background-color: #c0392b;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Certificate Badge */
        .certificate-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid var(--gold);
            border-radius: 20px;
            padding: 5px 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        .certificate-badge i {
            color: var(--gold);
            margin-right: 5px;
        }
        
        /* Features Section */
        .features {
            padding: 60px 0;
            background-color: white;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .section-title h2 {
            color: var(--navy);
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .section-title p {
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .feature-card {
            background-color: var(--light);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-top: 4px solid var(--dark-green);
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .feature-icon {
            width: 70px;
            height: 70px;
            background-color: var(--dark-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 30px;
        }
        
        .feature-card h3 {
            color: var(--navy);
            margin-bottom: 15px;
        }
        
        /* Courses Section */
        .courses {
            padding: 60px 0;
            background-color: #f9f9f9;
        }
        
        .course-category {
            margin-bottom: 50px;
        }
        
        .category-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gold);
        }
        
        .category-header h3 {
            color: var(--navy);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .category-header p {
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .course-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
        }
        
        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .course-header {
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .course-header.kids {
            background: linear-gradient(135deg, var(--warning), #e67e22);
        }
        
        .course-header.regular {
            background: linear-gradient(135deg, var(--navy), var(--dark-green));
        }
        
        .course-level {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--gold);
            color: var(--navy);
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .course-header h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .course-content {
            padding: 20px;
        }
        
        .course-content p {
            margin-bottom: 15px;
            color: #666;
        }
        
        .course-features {
            margin-bottom: 20px;
        }
        
        .course-feature {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
            color: #555;
        }
        
        .course-feature i {
            color: var(--success);
            margin-right: 8px;
            font-size: 12px;
        }
        
        .course-button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: var(--dark-green);
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
            border: none;
        }
        
        .course-button:hover {
            background-color: #164322;
        }
        
        .course-button.locked {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .course-button.locked:hover {
            background-color: #7f8c8d;
        }
        
        .lock-icon {
            margin-right: 5px;
        }
        
        /* Access Info Styles */
        .access-info {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--light-gold);
            border-radius: 8px;
            border-left: 4px solid var(--gold);
        }
        
        /* Footer */
        footer {
            background: linear-gradient(135deg, var(--navy), var(--dark-green));
            color: white;
            padding: 30px 0;
            text-align: center;
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .footer-logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--gold);
        }
        
        .footer-contact {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }
        
        .footer-contact a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }
        
        .footer-contact a:hover {
            color: var(--light-gold);
        }
        
        .copyright {
            font-size: 14px;
            color: #ddd;
            margin-top: 10px;
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .user-info {
                margin-top: 10px;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .footer-contact {
                flex-direction: column;
                gap: 10px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .admin-container {
                width: 98%;
                height: 95vh;
                padding: 10px;
            }
            
            .courses-grid {
                grid-template-columns: 1fr;
            }
            
            #installPromo {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
        
            /* Additional role badge styles */
        .user-role-badge.coding {
            background-color: #3498db;
            color: white;
        }
        
        .user-role-badge.packages {
            background-color: #9b59b6;
            color: white;
        }
        
        .user-role-badge.bookkeeping {
            background-color: #1abc9c;
            color: white;
        }
        
        .role-badge.coding {
            background-color: #3498db;
            color: white;
        }
        
        .role-badge.packages {
            background-color: #9b59b6;
            color: white;
        }
        
        .role-badge.bookkeeping {
            background-color: #1abc9c;
            color: white;
        }
        
        /* Disabled registration styles */
        .registration-disabled {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .registration-disabled i {
            font-size: 2rem;
            color: var(--warning);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-container">
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="info">Registration Info</div>
            </div>
            
            <div class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="Enter your registered email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password">
                </div>
                <button class="auth-btn" id="loginBtn">Login</button>
                <div class="auth-error" id="loginError"></div>
                
                <div class="registration-disabled">
                    <i class="fas fa-user-plus"></i>
                    <h3>Registration Disabled</h3>
                    <p>User registration is only available through administration. Please contact us if you need an account.</p>
                </div>
            </div>
            
            <div class="auth-form" id="infoForm">
                <div class="registration-disabled">
                    <i class="fas fa-user-shield"></i>
                    <h3>Account Registration</h3>
                    <p>User accounts are created by administrators only.</p>
                    <p>If you need access to our courses, please contact the administration team.</p>
                    <div class="whatsapp-enroll" style="margin-top: 20px;">
                        <a href="https://wa.me/254734080808?text=Hello! I need access to JOSHCAB Training Institute courses" class="whatsapp-btn" target="_blank">
                            <i class="fab fa-whatsapp"></i> Contact Admin via WhatsApp
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-container">
            <div class="admin-header">
                <h2><i class="fas fa-cogs"></i> Admin Panel</h2>
                <button class="auth-button" id="closeAdminBtn">Close</button>
            </div>
            
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="users">Manage Users</div>
                <div class="admin-tab" data-tab="add-user">Add User</div>
                <div class="admin-tab" data-tab="stats">Statistics</div>
            </div>
            
            <div class="admin-content">
                <div class="admin-section active" id="usersSection">
                    <h3>User Management</h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="admin-section" id="addUserSection">
                    <h3>Add New User</h3>
                    <div class="add-user-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="adminUserName">Full Name</label>
                                <input type="text" id="adminUserName" placeholder="Enter full name">
                            </div>
                            <div class="form-group">
                                <label for="adminUserEmail">Email</label>
                                <input type="email" id="adminUserEmail" placeholder="Enter email">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="adminUserPassword">Password</label>
                                <input type="password" id="adminUserPassword" placeholder="Enter password">
                            </div>
                            <div class="form-group">
                                <label for="adminUserRole">Role</label>
                                <select id="adminUserRole">
                                    <option value="coding">Coding</option>
                                    <option value="packages">Packages</option>
                                    <option value="kid">Kid</option>
                                    <option value="bookkeeping">Bookkeeping</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                        </div>
                        <button class="auth-btn" id="addUserBtn">Add User</button>
                        <div class="auth-error" id="addUserError"></div>
                        <div class="auth-success" id="addUserSuccess"></div>
                    </div>
                </div>
                
                <div class="admin-section" id="statsSection">
                    <h3>System Statistics</h3>
                    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: var(--shadow);">
                            <h4 style="color: var(--navy); font-size: 2rem; margin-bottom: 10px;" id="totalUsers">0</h4>
                            <p style="color: #666;">Total Users</p>
                        </div>
                        <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: var(--shadow);">
                            <h4 style="color: #3498db; font-size: 2rem; margin-bottom: 10px;" id="totalCoding">0</h4>
                            <p style="color: #666;">Coding</p>
                        </div>
                        <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: var(--shadow);">
                            <h4 style="color: #9b59b6; font-size: 2rem; margin-bottom: 10px;" id="totalPackages">0</h4>
                            <p style="color: #666;">Packages</p>
                        </div>
                        <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: var(--shadow);">
                            <h4 style="color: var(--warning); font-size: 2rem; margin-bottom: 10px;" id="totalKids">0</h4>
                            <p style="color: #666;">Kids</p>
                        </div>
                        <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: var(--shadow);">
                            <h4 style="color: #1abc9c; font-size: 2rem; margin-bottom: 10px;" id="totalBookkeeping">0</h4>
                            <p style="color: #666;">Bookkeeping</p>
                        </div>
                        <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: var(--shadow);">
                            <h4 style="color: var(--danger); font-size: 2rem; margin-bottom: 10px;" id="totalAdmins">0</h4>
                            <p style="color: #666;">Admins</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Header Section -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-laptop-code"></i>
                    <h1>JOSHCAB TRAINING INSTITUTE</h1>
                </div>
                
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar">JD</div>
                    <span id="userName">John Doe</span>
                    <span class="user-role-badge student" id="userRoleBadge">Student</span>
                    <button class="auth-button" id="adminPanelBtn" style="display: none;">Admin Panel</button>
                    <button class="auth-button" id="logoutBtn">Logout</button>
                </div>
                
                <div class="auth-buttons" id="authButtons">
                    <button class="auth-button" id="showLoginBtn">Login</button>
                    <button class="auth-button" id="showInfoBtn">Registration Info</button>
                </div>
                
                <div class="contact-info">
                    <i class="fas fa-phone"></i> 0734080808
                </div>
            </div>
        </div>
    </header>
    
    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <div class="certificate-badge">
                    <i class="fas fa-award"></i> Professional Digital Skills Training
                </div>
                <h2>Digital Skills Training Programs</h2>
                <p>Master essential digital skills with our comprehensive courses designed for all ages and skill levels.</p>
                <a href="#" class="cta-button" id="heroCta">Explore Courses</a>
                <a href="#" class="admin-button" id="adminButton" style="display: none;">Admin Panel</a>
            </div>
        </div>
    </section>
    
    <!-- Features Section -->
    <section class="features">
        <div class="container">
            <div class="section-title">
                <h2>Why Choose JOSHCAB Training Institute?</h2>
                <p>We provide quality digital skills training with practical, hands-on approach</p>
            </div>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <h3>Expert Instructors</h3>
                    <p>Learn from industry professionals with years of experience in digital skills training.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-laptop-code"></i>
                    </div>
                    <h3>Hands-on Learning</h3>
                    <p>Practical projects and real-world applications to reinforce your learning.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-certificate"></i>
                    </div>
                    <h3>Certification</h3>
                    <p>Earn recognized certificates upon successful completion of your courses.</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Courses Section -->
    <section class="courses">
        <div class="container">
            <div class="section-title">
                <h2>Our Courses</h2>
                <p>Comprehensive digital skills training for all age groups and skill levels</p>
            </div>

            <!-- Access Info Box -->
            <div class="access-info" id="accessInfo" style="display: none;">
                <i class="fas fa-unlock"></i> <strong>All Courses Accessible!</strong> You now have access to all course materials.
            </div>
            
            <!-- Kids Courses -->
            <div class="course-category">
                <div class="category-header">
                    <h3><i class="fas fa-child"></i> Kids Courses (Ages 8-12)</h3>
                    <p>Fun and engaging digital skills courses designed specifically for children</p>
                </div>
                
                <div class="courses-grid">
                    <div class="course-card">
                        <div class="course-header kids">
                            <div class="course-level">Beginner</div>
                            <h3>Introduction to Digital Skills</h3>
                            <p>Foundation Course</p>
                        </div>
                        <div class="course-content">
                            <p>Perfect starting point for kids to learn basic computer skills and digital literacy in a fun, engaging way.</p>
                            <div class="course-features">
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Basic computer operations</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Introduction to coding concepts</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Digital creativity tools</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Online safety basics</span>
                                </div>
                            </div>
                            <div class="course-stats" style="display: flex; justify-content: space-between; font-size: 14px; color: #777; margin-bottom: 15px;">
                                <span><i class="far fa-clock"></i> 8 weeks</span>
                                <span><i class="far fa-file-alt"></i> 16 lessons</span>
                            </div>
                            <button class="course-button locked" id="kidsIntroBtn" disabled>
                                <i class="fas fa-lock lock-icon"></i> Login to Access
                            </button>
                        </div>
                    </div>
                    
                    <div class="course-card">
                        <div class="course-header kids">
                            <div class="course-level">Intermediate</div>
                            <h3>Digital Skills Course</h3>
                            <p>Comprehensive Program</p>
                        </div>
                        <div class="course-content">
                            <p>Advanced digital skills training covering various aspects of technology and digital tools.</p>
                            <div class="course-features">
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Advanced computer skills</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Basic programming</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Digital presentation skills</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Creative digital projects</span>
                                </div>
                            </div>
                            <div class="course-stats" style="display: flex; justify-content: space-between; font-size: 14px; color: #777; margin-bottom: 15px;">
                                <span><i class="far fa-clock"></i> 12 weeks</span>
                                <span><i class="far fa-file-alt"></i> 24 lessons</span>
                            </div>
                            <button class="course-button locked" id="kidsDigitalBtn" disabled>
                                <i class="fas fa-lock lock-icon"></i> Login to Access
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Regular Courses -->
            <div class="course-category">
                <div class="category-header">
                    <h3><i class="fas fa-users"></i> Regular Courses</h3>
                    <p>Professional digital skills training for students and adults</p>
                </div>
                
                <div class="courses-grid">
                    <div class="course-card">
                        <div class="course-header regular">
                            <div class="course-level">Intermediate</div>
                            <h3>Web Design</h3>
                            <p>Frontend Development</p>
                        </div>
                        <div class="course-content">
                            <p>Learn to create beautiful, responsive websites using modern web technologies and design principles.</p>
                            <div class="course-features">
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>HTML5 & CSS3</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>JavaScript fundamentals</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Responsive design</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>UI/UX principles</span>
                                </div>
                            </div>
                            <div class="course-stats" style="display: flex; justify-content: space-between; font-size: 14px; color: #777; margin-bottom: 15px;">
                                <span><i class="far fa-clock"></i> 10 weeks</span>
                                <span><i class="far fa-file-alt"></i> 20 lessons</span>
                            </div>
                            <button class="course-button locked" id="webDesignBtn" disabled>
                                <i class="fas fa-lock lock-icon"></i> Login to Access
                            </button>
                        </div>
                    </div>
                    
                    <div class="course-card">
                        <div class="course-header regular">
                            <div class="course-level">Advanced</div>
                            <h3>Advanced ICT Course</h3>
                            <p>Professional Level</p>
                        </div>
                        <div class="course-content">
                            <p>Comprehensive ICT training covering advanced topics for professional development and career advancement.</p>
                            <div class="course-features">
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Advanced networking</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Database management</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>System administration</span>
                                </div>
                                <div class="course-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>ICT project management</span>
                                </div>
                            </div>
                            <div class="course-stats" style="display: flex; justify-content: space-between; font-size: 14px; color: #777; margin-bottom: 15px;">
                                <span><i class="far fa-clock"></i> 16 weeks</span>
                                <span><i class="far fa-file-alt"></i> 32 lessons</span>
                            </div>
                            <button class="course-button locked" id="advancedIctBtn" disabled>
                                <i class="fas fa-lock lock-icon"></i> Login to Access
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="whatsapp-enroll" style="margin-top: 40px; text-align: center;">
                <h3>Ready to Start Your Digital Skills Journey?</h3>
                <p>Contact us via WhatsApp to register for any of our courses</p>
                <a href="https://wa.me/254734080808?text=Hello! I'm interested in registering for courses at JOSHCAB Training Institute" class="whatsapp-btn" target="_blank" style="font-size: 1.1rem; padding: 12px 25px;">
                    <i class="fab fa-whatsapp"></i> Enroll via WhatsApp
                </a>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">JOSHCAB TRAINING INSTITUTE</div>
                <div class="footer-contact">
                    <a href="tel:0734080808"><i class="fas fa-phone"></i> 0734080808</a>
                    <a href="mailto:info@joshcab.ac.ke"><i class="fas fa-envelope"></i> info@joshcab.ac.ke</a>
                    <a href="#"><i class="fas fa-map-marker-alt"></i> Mwiki, Nairobi</a>
                </div>
                <div class="copyright">
                    &copy; 2025 JOSHCAB TRAINING INSTITUTE. All rights reserved.
                </div>
            </div>
        </div>
    </footer>
    
<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyD44h0Uak9EeQs2A_aAfSvyRKT4jgdSuHg",
        authDomain: "jtimwiki.firebaseapp.com",
        projectId: "jtimwiki",
        storageBucket: "jtimwiki.firebasestorage.app",
        messagingSenderId: "125581944053",
        appId: "1:125581944053:web:e314fcdd288daf97c1d1bc",
        measurementId: "G-WNVG1L3CZK"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // ============ ENHANCED INSTALL PROMPT CODE ============
    /* ... (keep install prompt code the same) ... */
    // ============ END OF ENHANCED INSTALL PROMPT CODE ============
    
    // DOM Elements
    const authModal = document.getElementById('authModal');
    const adminPanel = document.getElementById('adminPanel');
    const loginBtn = document.getElementById('loginBtn');
    const addUserBtn = document.getElementById('addUserBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const adminPanelBtn = document.getElementById('adminPanelBtn');
    const closeAdminBtn = document.getElementById('closeAdminBtn');
    const adminButton = document.getElementById('adminButton');
    const userInfo = document.getElementById('userInfo');
    const authButtons = document.getElementById('authButtons');
    const userAvatar = document.getElementById('userAvatar');
    const userName = document.getElementById('userName');
    const userRoleBadge = document.getElementById('userRoleBadge');
    const heroCta = document.getElementById('heroCta');
    const accessInfo = document.getElementById('accessInfo');

    // Course buttons
    const courseButtons = {
        'kidsIntro': document.getElementById('kidsIntroBtn'),
        'kidsDigital': document.getElementById('kidsDigitalBtn'),
        'webDesign': document.getElementById('webDesignBtn'),
        'advancedIct': document.getElementById('advancedIctBtn')
    };

    // Enhanced role-based redirects with folder restrictions
    const roleRedirects = {
        admin: 'admin/admin.html',
        coding: 'coding/index.html',
        packages: 'packages/home.html',
        kid: 'kids/dashboard.html',
        bookkeeping: 'bookkeeping/index.html'
    };

    // Role-based folder access permissions
    const rolePermissions = {
        admin: ['admin', 'coding', 'packages', 'kids', 'bookkeeping'],
        coding: ['coding'],
        packages: ['packages'],
        kid: ['kids'],
        bookkeeping: ['bookkeeping']
    };

    // Current user data
    let currentUserData = null;

    // Wait for auth manager to be ready
    document.addEventListener('DOMContentLoaded', function() {
        // Listen for auth state changes
        window.authManager.onAuthStateChange(({ user, isValid, studentData }) => {
            updateUI(user, isValid, studentData);
            
            // AUTO-REDIRECT: If user is valid and logged in, redirect to their role folder
            if (user && isValid && studentData) {
                const role = studentData.role || 'coding';
                const redirectUrl = roleRedirects[role];
                
                // Only redirect if we're not already on the correct page
                if (!window.location.pathname.includes(redirectUrl.split('/')[0])) {
                    setTimeout(() => {
                        window.location.href = redirectUrl;
                    }, 1000); // 1 second delay to show the UI update
                }
            }
        });
    });

    // Update UI based on auth state
    function updateUI(user, isValid, studentData) {
        if (user && isValid) {
            // User is logged in and valid
            userInfo.style.display = 'flex';
            authButtons.style.display = 'none';
            accessInfo.style.display = 'block';
            
            // Update user details
            currentUserData = studentData;
            userName.textContent = studentData?.name || 'Student';
            userAvatar.textContent = (studentData?.name || 'S').charAt(0).toUpperCase();
            
            // Update role badge
            const role = studentData?.role || 'coding';
            userRoleBadge.textContent = role.charAt(0).toUpperCase() + role.slice(1);
            userRoleBadge.className = `user-role-badge ${role}`;
            
            // Show admin panel button if user is admin
            if (role === 'admin') {
                adminPanelBtn.style.display = 'block';
                adminButton.style.display = 'inline-block';
            } else {
                adminPanelBtn.style.display = 'none';
                adminButton.style.display = 'none';
            }
            
            heroCta.textContent = 'Access Courses';
            
            // Unlock courses based on role
            unlockCoursesByRole(role);
            updateCourseProgress();
            
        } else {
            // User not logged in or invalid
            userInfo.style.display = 'none';
            authButtons.style.display = 'flex';
            accessInfo.style.display = 'none';
            adminPanelBtn.style.display = 'none';
            adminButton.style.display = 'none';
            
            heroCta.textContent = 'Explore Courses';
            lockAllCourses();
        }
    }

    // Unlock courses based on user role
    function unlockCoursesByRole(role) {
        // First lock all courses
        lockAllCourses();
        
        // Then unlock based on role permissions
        switch(role) {
            case 'admin':
                // Admin can access all courses
                unlockAllCourses();
                break;
            case 'coding':
                // Coding role - unlock coding-related courses
                if (courseButtons.webDesign) {
                    courseButtons.webDesign.classList.remove('locked');
                    courseButtons.webDesign.disabled = false;
                    courseButtons.webDesign.innerHTML = 'Access Course';
                }
                if (courseButtons.advancedIct) {
                    courseButtons.advancedIct.classList.remove('locked');
                    courseButtons.advancedIct.disabled = false;
                    courseButtons.advancedIct.innerHTML = 'Access Course';
                }
                break;
            case 'packages':
                // Packages role - unlock package-related courses
                // Add specific package courses here when available
                showNotification('Package courses coming soon!', 'info');
                break;
            case 'kid':
                // Kid role - unlock kids courses
                if (courseButtons.kidsIntro) {
                    courseButtons.kidsIntro.classList.remove('locked');
                    courseButtons.kidsIntro.disabled = false;
                    courseButtons.kidsIntro.innerHTML = 'Access Course';
                }
                if (courseButtons.kidsDigital) {
                    courseButtons.kidsDigital.classList.remove('locked');
                    courseButtons.kidsDigital.disabled = false;
                    courseButtons.kidsDigital.innerHTML = 'Access Course';
                }
                break;
            case 'bookkeeping':
                // Bookkeeping role - unlock bookkeeping courses
                // Add specific bookkeeping courses here when available
                showNotification('Bookkeeping courses coming soon!', 'info');
                break;
        }
    }

    // Unlock all courses for admin
    function unlockAllCourses() {
        for (const [courseId, courseBtn] of Object.entries(courseButtons)) {
            if (courseBtn) {
                courseBtn.classList.remove('locked');
                courseBtn.disabled = false;
                courseBtn.innerHTML = 'Access Course';
            }
        }
    }

    // Lock all courses (when user logs out)
    function lockAllCourses() {
        for (const [courseId, courseBtn] of Object.entries(courseButtons)) {
            if (courseBtn) {
                courseBtn.classList.add('locked');
                courseBtn.disabled = true;
                courseBtn.innerHTML = '<i class="fas fa-lock lock-icon"></i> Login to Access';
            }
        }
        
        // Reset progress indicators
        resetProgressIndicators();
    }

    // Reset progress indicators
    function resetProgressIndicators() {
        // Reset any progress bars or indicators
        const progressElements = document.querySelectorAll('.progress-fill');
        progressElements.forEach(element => {
            element.style.width = '0%';
        });
        
        const percentElements = document.querySelectorAll('.progress-percent');
        percentElements.forEach(element => {
            element.textContent = '0%';
        });
    }

    // Update course progress
    async function updateCourseProgress() {
        const user = auth.currentUser;
        if (!user) return;
        
        try {
            const doc = await db.collection('students').doc(user.uid).get();
            if (doc.exists) {
                const data = doc.data();
                const enrolledCourses = data.enrolledCourses || {};
                const completedCourses = data.completedCourses || {};
                
                // Calculate overall progress
                const totalEnrolled = Object.keys(enrolledCourses).length;
                const totalCompleted = Object.keys(completedCourses).length;
                
                const overallProgress = totalEnrolled > 0 ? (totalCompleted / totalEnrolled) * 100 : 0;
                
                // Update overall progress display if elements exist
                const progressElement = document.getElementById('courseProgress');
                const percentElement = document.getElementById('progressPercent');
                
                if (progressElement && percentElement) {
                    progressElement.style.width = `${overallProgress}%`;
                    percentElement.textContent = `${Math.round(overallProgress)}%`;
                }
                
                // Update individual course progress
                updateIndividualCourseProgress(data);
            }
        } catch (error) {
            console.error('Error updating progress:', error);
        }
    }

    // Update individual course progress
    function updateIndividualCourseProgress(studentData) {
        const completedCourses = studentData.completedCourses || {};
        
        // Update each course card with progress
        document.querySelectorAll('.course-card').forEach(card => {
            const courseId = card.querySelector('button').id.replace('Btn', '');
            const progressFill = card.querySelector('.progress-fill');
            const progressPercent = card.querySelector('.progress-percent');
            
            if (progressFill && progressPercent) {
                if (completedCourses[courseId]) {
                    progressFill.style.width = '100%';
                    progressPercent.textContent = '100%';
                } else {
                    progressFill.style.width = '0%';
                    progressPercent.textContent = '0%';
                }
            }
        });
    }

    // Add click handlers for all course buttons
    for (const [courseId, courseBtn] of Object.entries(courseButtons)) {
        if (courseBtn) {
            courseBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                
                if (window.authManager.isValidUser) {
                    const userRole = currentUserData?.role || 'coding';
                    
                    // Check if user has permission to access this course
                    if (hasCourseAccess(courseId, userRole)) {
                        // Track course access
                        await trackCourseAccess(courseId);
                        // Redirect to appropriate course page based on role
                        redirectToRoleDashboard(userRole);
                    } else {
                        showNotification('You do not have permission to access this course', 'error');
                    }
                } else {
                    authModal.classList.add('active');
                }
            });
        }
    }

    // Check if user has permission to access a course
    function hasCourseAccess(courseId, userRole) {
        // Admin has access to everything
        if (userRole === 'admin') return true;
        
        // Define course to role mapping
        const courseRoleMapping = {
            'kidsIntro': ['kid', 'admin'],
            'kidsDigital': ['kid', 'admin'],
            'webDesign': ['coding', 'admin'],
            'advancedIct': ['coding', 'admin']
        };
        
        return courseRoleMapping[courseId]?.includes(userRole) || false;
    }

    // Redirect to role-specific dashboard
    function redirectToRoleDashboard(role) {
        const redirectUrl = roleRedirects[role] || 'coding/index.html';
        window.location.href = redirectUrl;
    }

    // Track course access
    async function trackCourseAccess(courseId) {
        const user = auth.currentUser;
        if (!user) return;
        
        try {
            await db.collection('students').doc(user.uid).update({
                [`enrolledCourses.${courseId}`]: firebase.firestore.FieldValue.serverTimestamp(),
                lastAccessed: firebase.firestore.FieldValue.serverTimestamp()
            });
        } catch (error) {
            console.error('Error tracking course access:', error);
        }
    }

    // Login function using auth manager
    loginBtn.addEventListener('click', async () => {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const errorElement = document.getElementById('loginError');
        
        if (!email || !password) {
            errorElement.textContent = 'Please fill in all fields';
            errorElement.style.display = 'block';
            return;
        }
        
        // Show loading state
        loginBtn.innerHTML = 'Logging in... <i class="fas fa-spinner fa-spin"></i>';
        loginBtn.disabled = true;
        
        try {
            await window.authManager.login(email, password);
            authModal.classList.remove('active');
            errorElement.style.display = 'none';
            
            // Show welcome notification
            showNotification('Login successful! Redirecting...', 'success');
            
        } catch (error) {
            errorElement.textContent = error.message;
            errorElement.style.display = 'block';
            showNotification('Login failed. Please try again.', 'error');
        } finally {
            // Reset login button
            loginBtn.innerHTML = 'Login';
            loginBtn.disabled = false;
        }
    });

    // Logout function
    logoutBtn.addEventListener('click', () => {
        window.authManager.logout();
        showNotification('Logged out successfully', 'info');
    });

    // Admin panel functions
    adminPanelBtn.addEventListener('click', () => {
        adminPanel.classList.add('active');
        loadUsers();
        loadStats();
    });

    adminButton.addEventListener('click', (e) => {
        e.preventDefault();
        adminPanel.classList.add('active');
        loadUsers();
        loadStats();
    });

    closeAdminBtn.addEventListener('click', () => {
        adminPanel.classList.remove('active');
    });

    // Admin tab switching
    document.querySelectorAll('.admin-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            document.querySelectorAll('.admin-section').forEach(section => section.classList.remove('active'));
            document.getElementById(`${tabName}Section`).classList.add('active');
        });
    });

    // Load users for admin panel
    async function loadUsers() {
        try {
            const snapshot = await db.collection('students').get();
            const usersTableBody = document.getElementById('usersTableBody');
            usersTableBody.innerHTML = '';
            
            snapshot.forEach(doc => {
                const user = doc.data();
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td><span class="role-badge ${user.role}">${user.role}</span></td>
                    <td>Active</td>
                    <td>
                        <button class="action-btn edit-btn" data-id="${doc.id}">Edit</button>
                        <button class="action-btn delete-btn" data-id="${doc.id}">Delete</button>
                    </td>
                `;
                
                usersTableBody.appendChild(row);
            });
            
            // Add event listeners for action buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const userId = e.target.getAttribute('data-id');
                    editUser(userId);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const userId = e.target.getAttribute('data-id');
                    deleteUser(userId);
                });
            });
            
        } catch (error) {
            console.error('Error loading users:', error);
            showNotification('Error loading users', 'error');
        }
    }

    // Load stats for admin panel
    async function loadStats() {
        try {
            const snapshot = await db.collection('students').get();
            let totalUsers = 0;
            let totalCoding = 0;
            let totalPackages = 0;
            let totalKids = 0;
            let totalBookkeeping = 0;
            let totalAdmins = 0;
            
            snapshot.forEach(doc => {
                const user = doc.data();
                totalUsers++;
                
                if (user.role === 'coding') totalCoding++;
                else if (user.role === 'packages') totalPackages++;
                else if (user.role === 'kid') totalKids++;
                else if (user.role === 'bookkeeping') totalBookkeeping++;
                else if (user.role === 'admin') totalAdmins++;
            });
            
            // Update the stats display
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalCoding').textContent = totalCoding;
            document.getElementById('totalPackages').textContent = totalPackages;
            document.getElementById('totalKids').textContent = totalKids;
            document.getElementById('totalBookkeeping').textContent = totalBookkeeping;
            document.getElementById('totalAdmins').textContent = totalAdmins;
            
        } catch (error) {
            console.error('Error loading stats:', error);
            showNotification('Error loading statistics', 'error');
        }
    }

    // Add user from admin panel
    addUserBtn.addEventListener('click', async () => {
        const name = document.getElementById('adminUserName').value;
        const email = document.getElementById('adminUserEmail').value;
        const password = document.getElementById('adminUserPassword').value;
        const role = document.getElementById('adminUserRole').value;
        const errorElement = document.getElementById('addUserError');
        const successElement = document.getElementById('addUserSuccess');
        
        if (!name || !email || !password) {
            errorElement.textContent = 'Please fill in all fields';
            errorElement.style.display = 'block';
            successElement.style.display = 'none';
            return;
        }
        
        // Show loading state
        addUserBtn.innerHTML = 'Adding User... <i class="fas fa-spinner fa-spin"></i>';
        addUserBtn.disabled = true;
        
        try {
            // Create user with Firebase Auth
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;
            
            // Save user data to Firestore
            await db.collection('students').doc(user.uid).set({
                name: name,
                email: email,
                role: role,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                enrolledCourses: {},
                completedCourses: {},
                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            successElement.textContent = 'User added successfully!';
            successElement.style.display = 'block';
            errorElement.style.display = 'none';
            
            showNotification('User added successfully!', 'success');
            
            // Clear form
            document.getElementById('adminUserName').value = '';
            document.getElementById('adminUserEmail').value = '';
            document.getElementById('adminUserPassword').value = '';
            
            // Reload users and stats
            loadUsers();
            loadStats();
            
        } catch (error) {
            errorElement.textContent = error.message;
            errorElement.style.display = 'block';
            successElement.style.display = 'none';
            showNotification('Error adding user', 'error');
        } finally {
            // Reset button
            addUserBtn.innerHTML = 'Add User';
            addUserBtn.disabled = false;
        }
    });

    // Edit user function
    async function editUser(userId) {
        showNotification('Edit feature coming soon', 'info');
    }

    // Delete user function
    async function deleteUser(userId) {
        if (confirm('Are you sure you want to delete this user?')) {
            try {
                // Delete from Firestore
                await db.collection('students').doc(userId).delete();
                
                showNotification('User deleted successfully!', 'success');
                loadUsers();
                loadStats();
            } catch (error) {
                console.error('Error deleting user:', error);
                showNotification('Error deleting user', 'error');
            }
        }
    }

    // Auth tab switching
    document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            document.getElementById(`${tabName}Form`).classList.add('active');
            document.getElementById('loginError').style.display = 'none';
        });
    });

    // Show login modal
    document.getElementById('showLoginBtn').addEventListener('click', () => {
        authModal.classList.add('active');
        document.querySelector('.auth-tab[data-tab="login"]').click();
    });

    // Show info modal  
    document.getElementById('showInfoBtn').addEventListener('click', () => {
        authModal.classList.add('active');
        document.querySelector('.auth-tab[data-tab="info"]').click();
    });

    // Hero CTA button
    heroCta.addEventListener('click', (e) => {
        e.preventDefault();
        if (window.authManager.isValidUser) {
            // Redirect based on role
            const role = currentUserData?.role || 'coding';
            window.location.href = roleRedirects[role] || 'coding/index.html';
        } else {
            document.querySelector('.courses').scrollIntoView({ behavior: 'smooth' });
        }
    });

    // Close modal when clicking outside
    authModal.addEventListener('click', (e) => {
        if (e.target === authModal) {
            authModal.classList.remove('active');
        }
    });

    adminPanel.addEventListener('click', (e) => {
        if (e.target === adminPanel) {
            adminPanel.classList.remove('active');
        }
    });

    // ============ ENHANCED NOTIFICATION SYSTEM ============
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        const typeStyles = {
            success: { background: 'var(--success)', icon: 'fa-check-circle' },
            error: { background: 'var(--danger)', icon: 'fa-exclamation-circle' },
            warning: { background: 'var(--warning)', icon: 'fa-exclamation-triangle' },
            info: { background: 'var(--info)', icon: 'fa-info-circle' }
        };
        
        const style = typeStyles[type] || typeStyles.info;
        
        notification.style.cssText = `
            position: fixed;
            top: 70px;
            right: 20px;
            background: ${style.background};
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 10000;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
            animation: slideInRight 0.3s ease;
        `;
        
        notification.innerHTML = `
            <i class="fas ${style.icon}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                notification.remove();
            }, 300);
        }, 5000);
        
        // Add click to dismiss
        notification.addEventListener('click', () => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                notification.remove();
            }, 300);
        });
    }

    // Add CSS for notification animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
</script>

    <!-- PWA Service Worker -->
    <script>
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker
                .register("service-worker.js")
                .then((reg) => console.log("Service Worker registered:", reg.scope))
                .catch((err) => console.error("SW registration failed:", err));
            });
        }
    </script>

   
</body>
</html>